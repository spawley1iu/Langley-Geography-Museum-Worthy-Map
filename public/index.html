<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Langley-Geography-Museum-Worthy-Map</title>

  <!-- MapTiler SDK -->
  <script src="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.umd.min.js"></script>
  <link href="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.css" rel="stylesheet" />

  <!-- Chart.js for Demographics -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      overflow: hidden;
    }
    #map {
      height: 100vh;
      width: 100vw;
    }
    /* Custom styles for MapTiler popups */
    .maptiler-popup-content {
      background-color: rgba(31, 41, 55, 0.9); /* gray-800 */
      color: #E5E7EB; /* gray-200 */
      border-radius: 8px;
      border: 1px solid #4B5563; /* gray-600 */
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      padding: 1rem;
      font-family: 'Inter', sans-serif;
      max-width: 320px;
    }
    .maptiler-popup-content h3 {
      font-weight: 700;
      font-size: 1.125rem;
      margin-bottom: 0.5rem;
      color: #FFF;
    }
    .maptiler-popup-content p {
      font-size: 0.875rem;
      margin-bottom: 0;
      line-height: 1.5;
    }
    .maptiler-popup-anchor-bottom .maptiler-popup-tip {
      border-top-color: rgba(31, 41, 55, 0.9);
    }
    .maptiler-popup-close-button {
      color: #fff;
      opacity: 0.7;
    }

    /* Custom scrollbar for panels */
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.5); }

    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gray-900 text-white">

<div id="map" class="absolute top-0 bottom-0 left-0 right-0"></div>

<!-- Main Title -->
<div class="absolute top-4 left-1/2 -translate-x-1/2 bg-gray-900/50 backdrop-blur-md p-3 rounded-lg shadow-lg text-center z-10">
  <h1 class="text-xl md:text-2xl font-bold text-white">Langley-Geography-Museum-Worthy-Map</h1>
  <p class="text-sm text-gray-300">An Interactive Exploration of Native Lands</p>
</div>

<!-- Left Control Panel -->
<div id="control-panel" class="absolute top-4 left-4 w-80 max-w-[calc(100vw-2rem)] bg-gray-800/60 backdrop-blur-md rounded-lg shadow-2xl p-5 text-gray-200 transition-transform duration-300 ease-in-out z-10 flex flex-col">
  <h2 class="text-lg font-bold text-white mb-4">Map Controls</h2>

  <div class="relative">
    <label for="search-input" class="text-sm font-semibold text-gray-300 mb-1 block">Search for a Tribe</label>
    <input type="text" id="search-input" placeholder="e.g., Cherokee, Navajo..." class="w-full bg-gray-900/80 border border-gray-600 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-400">
    <div id="search-results" class="absolute z-20 w-full bg-gray-800 border border-gray-600 rounded-md mt-1 max-h-48 overflow-y-auto custom-scrollbar hidden"></div>
  </div>

  <div class="mt-6">
    <h3 class="text-md font-semibold text-gray-300 mb-2">Toggle Layers</h3>
    <div class="space-y-2">
      <label class="flex items-center space-x-3 cursor-pointer">
        <input type="checkbox" id="toggle-historical" class="h-5 w-5 rounded bg-gray-700 border-gray-500 text-indigo-500 focus:ring-indigo-400" checked>
        <span>Example Historical Territories</span>
      </label>
      <label class="flex items-center space-x-3 cursor-pointer">
        <input type="checkbox" id="toggle-modern" class="h-5 w-5 rounded bg-gray-700 border-gray-500 text-indigo-500 focus:ring-indigo-400" checked>
        <span>Modern Tribal Locations</span>
      </label>
      <label class="flex items-center space-x-3 cursor-pointer">
        <input type="checkbox" id="toggle-ancestral" class="h-5 w-5 rounded bg-gray-700 border-gray-500 text-indigo-500 focus:ring-indigo-400">
        <span>Ancestral Territories (Live API)</span>
        <div id="ancestral-loader" class="spinner hidden ml-2"></div>
      </label>
      <label class="flex items-center space-x-3 cursor-pointer">
        <input type="checkbox" id="toggle-demographics" class="h-5 w-5 rounded bg-gray-700 border-gray-500 text-indigo-500 focus:ring-indigo-400">
        <span>County Demographics (AI/AN %)</span>
      </label>
    </div>
  </div>
</div>

<!-- Story Chapters Panel -->
<div class="absolute top-1/2 -translate-y-1/2 right-4 w-72 max-w-[calc(100vw-2rem)] bg-gray-800/60 backdrop-blur-md rounded-lg shadow-2xl transition-all duration-300 ease-in-out z-10">
  <h2 class="text-lg font-bold text-white p-4 border-b border-gray-700/50">Story Chapters</h2>
  <div id="story-chapters-list" class="p-2 custom-scrollbar overflow-y-auto max-h-[50vh]"></div>
</div>

<!-- Timeline Controls -->
<div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-gray-900 via-gray-900/80 to-transparent z-10">
  <div class="max-w-4xl mx-auto bg-gray-800/60 backdrop-blur-md p-4 rounded-lg shadow-2xl">
    <div class="flex items-center space-x-4">
      <button id="play-pause-btn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      </button>
      <input id="timeline-slider" type="range" min="1600" max="2025" value="1600" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
      <div class="text-center w-24">
        <span id="year-display" class="text-xl font-bold text-white">1600</span>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // --- CONFIG & DATA ---
    const MAPTILER_API_KEY = 'MS2P3mXbzbrTM7EWm5y8';
    const storyData = [ { "title": "Arrival of Colonists", "description": "Early European settlements begin to appear on the East Coast, marking the beginning of centuries of conflict, displacement, and treaties.", "year": 1620, "location": [-70.6, 42.0], "zoom": 5 }, { "title": "The Pueblo Revolt", "description": "In 1680, the Pueblo people of modern-day New Mexico rose up against Spanish colonizers in a successful revolt, driving them out for 12 years.", "year": 1680, "location": [-106.0, 35.5], "zoom": 5 }, { "title": "Indian Removal Act", "description": "The Indian Removal Act is signed into law by President Andrew Jackson, authorizing the president to grant unsettled lands west of the Mississippi in exchange for Indian lands within existing state borders.", "year": 1830, "location": [-84, 34], "zoom": 4 }, { "title": "The Great Removal (Trail of Tears)", "description": "In 1838, the U.S. government forcibly removed more than 16,000 Cherokee people from their homelands in the southeastern United States to 'Indian Territory' (present-day Oklahoma). Thousands died on the journey.", "year": 1838, "location": [-89.0, 36.0], "zoom": 4 }, { "title": "The Long Walk", "description": "From 1864-1866, the U.S. government forced the Navajo people to walk hundreds of miles from their homeland to an internment camp at Bosque Redondo, New Mexico.", "year": 1864, "location": [-106.5, 34.5], "zoom": 5 }, { "title": "Dawes Act", "description": "The Dawes Act of 1887 authorized the U.S. government to break up tribal lands by partitioning them into individual plots. The objective was to assimilate Native Americans into mainstream US society.", "year": 1887, "location": [-98, 39], "zoom": 3 }, { "title": "Indian Reorganization Act", "description": "The Indian Reorganization Act of 1934, also known as the 'Indian New Deal', aimed to reverse the assimilationist policies of the Dawes Act and strengthen tribal governments.", "year": 1934, "location": [-98, 39], "zoom": 3 }, { "title": "Indian Self-Determination Act", "description": "The 1975 Indian Self-Determination and Education Assistance Act allowed tribes to assume responsibility for federally funded programs, increasing tribal sovereignty.", "year": 1975, "location": [-98, 39], "zoom": 3 } ];
    const countyDataUrl = 'https://raw.githubusercontent.com/plotly/datasets/master/geojson-counties-fips.json'; // Publicly available county geojson
    // NOTE: The above county data does not have demographic info. For a real museum exhibit,
    // you would need to source a GeoJSON file with 2020 Census data pre-joined.
    // For this demo, we will add *mock* demographic data to a few counties after loading.
    const tribalLandsData = { "type": "FeatureCollection", "features": [ { "type": "Feature", "properties": { "name": "Powhatan Confederacy", "description": "A powerful confederation of Algonquian-speaking peoples in what is now eastern Virginia at the time of the first English settlements.", "startYear": 1600, "endYear": 1646, "color": "#e67e22", "videoUrl": "https://www.youtube.com/embed/i_kH eloquXk" }, "geometry": { "type": "Polygon", "coordinates": [ [ [-77.5, 38.5], [-76.0, 38.0], [-76.2, 36.8], [-78.0, 37.0], [-77.5, 38.5] ] ] } }, { "type": "Feature", "properties": { "name": "Haudenosaunee (Iroquois) Confederacy", "description": "A confederacy of six nations that dominated the northeastern region.", "startYear": 1600, "endYear": 1784, "color": "#3498db", "videoUrl": "https://www.youtube.com/embed/kG232rGg6i4" }, "geometry": { "type": "Polygon", "coordinates": [ [ [-79, 44.5], [-73, 44], [-74, 42], [-79, 42.5], [-79, 44.5] ] ] } }, { "type": "Feature", "properties": { "name": "Cherokee (ᏣᎳᎩ) Ancestral Lands", "description": "The vast ancestral homelands of the Cherokee people before forced removal in the 1830s.", "startYear": 1600, "endYear": 1838, "color": "#e74c3c", "videoUrl": "https://www.youtube.com/embed/uD3n14_z1hg" }, "geometry": { "type": "Polygon", "coordinates": [ [ [-86, 37], [-82, 37], [-82, 34], [-86, 34], [-86, 37] ] ] } }, { "type": "Feature", "properties": { "name": "Lakota Territory (Oceti Sakowin)", "description": "The Great Sioux Nation territory as recognized in the Treaty of Fort Laramie of 1851.", "startYear": 1750, "endYear": 1877, "color": "#f1c40f", "videoUrl": "https://www.youtube.com/embed/5j2bfR5L4dM" }, "geometry": { "type": "Polygon", "coordinates": [ [ [-105, 48], [-98, 48], [-97, 43], [-105, 43], [-105, 48] ] ] } }, { "type": "Feature", "properties": { "name": "Navajo Nation (Diné Bikéyah)", "description": "The modern-day boundaries of the Navajo Nation.", "startYear": 1868, "endYear": 2025, "color": "#9b59b6", "videoUrl": "https://www.youtube.com/embed/G-g3ceVwB34" }, "geometry": { "type": "Polygon", "coordinates": [ [ [-111.5, 37], [-109, 37], [-109, 35], [-111.5, 35], [-111.5, 37] ] ] } } ]};

    // --- UI ELEMENT REFERENCES ---
    const slider = document.getElementById('timeline-slider');
    const yearDisplay = document.getElementById('year-display');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const storyChaptersList = document.getElementById('story-chapters-list');
    const searchInput = document.getElementById('search-input');
    const searchResultsContainer = document.getElementById('search-results');
    const historicalToggle = document.getElementById('toggle-historical');
    const modernToggle = document.getElementById('toggle-modern');
    const ancestralToggle = document.getElementById('toggle-ancestral');
    const ancestralLoader = document.getElementById('ancestral-loader');
    const demographicsToggle = document.getElementById('toggle-demographics');

    let isPlaying = false;
    let animationFrameId = null;

    // --- MAP INITIALIZATION ---
    maptilersdk.config.apiKey = MAPTILER_API_KEY;
    const map = new maptilersdk.Map({
      container: 'map',
      style: maptilersdk.MapStyle.DATAVIZ.DARK,
      center: [-98, 39],
      zoom: 3.5
    });

    map.on('load', async () => {
      // Add sources
      map.addSource('polygons', { 'type': 'geojson', 'data': { type: 'FeatureCollection', features: tribalLandsData.features.filter(f => f.geometry.type === 'Polygon') } });
      map.addSource('points', { 'type': 'geojson', 'data': { type: 'FeatureCollection', features: tribalLandsData.features.filter(f => f.geometry.type === 'Point') } });
      map.addSource('ancestral-lands', { 'type': 'geojson', 'data': { type: 'FeatureCollection', features: [] } });
      map.addSource('highlight', { 'type': 'geojson', 'data': { type: 'FeatureCollection', features: [] } });

      // Fetch and process county data
      try {
        const response = await fetch(countyDataUrl);
        const countyGeoJSON = await response.json();

        // --- MOCK DATA INJECTION (FOR DEMO) ---
        // In a real application, this data would be part of your GeoJSON source.
        countyGeoJSON.features.forEach(f => {
          if (f.properties.NAME === 'Apache' && f.properties.STATE === '04') { // Apache County, AZ
            f.properties.AI_AN_POP = 49000; f.properties.TOTAL_POP = 71000; f.properties.POVERTY_RATE = 35.2; f.properties.MED_INCOME = 32500;
          } else if (f.properties.NAME === 'Oglala Lakota' && f.properties.STATE === '46') { // Oglala Lakota County, SD
            f.properties.AI_AN_POP = 12500; f.properties.TOTAL_POP = 14000; f.properties.POVERTY_RATE = 52.3; f.properties.MED_INCOME = 28700;
          }
        });

        map.addSource('counties', { 'type': 'geojson', 'data': countyGeoJSON });
      } catch (e) {
        console.error("Failed to load county data", e);
      }

      // Add layers
      map.addLayer({ 'id': 'county-fill', 'type': 'fill', 'source': 'counties', 'layout': {'visibility': 'none'}, 'paint': { 'fill-color': [ 'interpolate', ['linear'], ['/', ['get', 'AI_AN_POP'], ['get', 'TOTAL_POP']], 0, '#4a5568', 0.25, '#fde047', 0.5, '#f59e0b', 0.75, '#be123c' ], 'fill-opacity': 0.6 } });
      map.addLayer({ 'id': 'county-outline', 'type': 'line', 'source': 'counties', 'layout': {'visibility': 'none'}, 'paint': { 'line-color': '#a0aec0', 'line-width': 0.5 } });
      map.addLayer({ 'id': 'lands-fill', 'type': 'fill', 'source': 'polygons', 'paint': { 'fill-color': ['get', 'color'], 'fill-opacity': 0.5 } });
      map.addLayer({ 'id': 'lands-outline', 'type': 'line', 'source': 'polygons', 'paint': { 'line-color': ['get', 'color'], 'line-width': 1.5 } });
      map.addLayer({ 'id': 'lands-points', 'type': 'circle', 'source': 'points', 'paint': { 'circle-radius': 5, 'circle-color': ['get', 'color'], 'circle-stroke-color': '#000', 'circle-stroke-width': 1 } });
      map.addLayer({ 'id': 'ancestral-fill', 'type': 'fill', 'source': 'ancestral-lands', 'layout': {'visibility': 'none'}, 'paint': { 'fill-color': '#8B5CF6', 'fill-opacity': 0.3 } });
      map.addLayer({ 'id': 'ancestral-outline', 'type': 'line', 'source': 'ancestral-lands', 'layout': {'visibility': 'none'}, 'paint': { 'line-color': '#C4B5FD', 'line-width': 1, 'line-dasharray': [2, 2] } });
      map.addLayer({ 'id': 'highlight-layer', 'type': 'line', 'source': 'highlight', 'paint': { 'line-color': '#FBBF24', 'line-width': 4, 'line-opacity': 0.9 } });

      updateMapForYear(parseInt(slider.value, 10));
      setupInteractions(storyData);
    });

    // --- CORE FUNCTIONS ---
    function setupInteractions(storyData) {
      storyData.forEach(chapter => {
        const chapterDiv = document.createElement('div');
        chapterDiv.className = 'p-3 hover:bg-gray-700/70 rounded-md cursor-pointer transition-colors';
        chapterDiv.innerHTML = `<h3 class="font-semibold text-white">${chapter.title} (${chapter.year})</h3><p class="text-sm text-gray-300">${chapter.description}</p>`;
        chapterDiv.addEventListener('click', () => {
          slider.value = chapter.year;
          yearDisplay.textContent = chapter.year;
          updateMapForYear(chapter.year);
          map.flyTo({ center: chapter.location, zoom: chapter.zoom, duration: 2000 });
        });
        storyChaptersList.appendChild(chapterDiv);
      });

      map.on('click', (e) => {
        const features = map.queryRenderedFeatures(e.point, { layers: ['lands-fill', 'lands-points', 'ancestral-fill', 'county-fill'] });
        if (!features.length) {
          map.getSource('highlight').setData({ type: 'FeatureCollection', features: [] }); // Clear highlight
          return;
        }
        const feature = features[0];
        map.getSource('highlight').setData(feature.toJSON()); // Highlight clicked feature

        const props = feature.properties;
        let html = '<div></div>'; // Placeholder

        if (feature.layer.id === 'county-fill' && props.AI_AN_POP) {
          html = createCountyPopupHTML(props);
        } else if (feature.layer.id === 'ancestral-fill') {
          html = `<h3>${props.Name}</h3><p>This is an ancestral territory fetched from Native Land Digital.</p>`;
        } else {
          html = createTribePopupHTML(props);
        }

        const popup = new maptilersdk.Popup().setLngLat(e.lngLat).setHTML(html).addTo(map);

        // If it's a county popup, render the chart
        if (feature.layer.id === 'county-fill' && props.AI_AN_POP) {
          renderCountyChart(props);
        }
      });

      map.on('mouseenter', ['lands-fill', 'lands-points', 'ancestral-fill', 'county-fill'], () => { map.getCanvas().style.cursor = 'pointer'; });
      map.on('mouseleave', ['lands-fill', 'lands-points', 'ancestral-fill', 'county-fill'], () => { map.getCanvas().style.cursor = ''; });
      map.on('moveend', () => { if (ancestralToggle.checked) fetchAncestralLands(); });

      slider.addEventListener('input', (e) => { yearDisplay.textContent = e.target.value; updateMapForYear(parseInt(e.target.value, 10)) });
      playPauseBtn.addEventListener('click', handlePlayPause);
      searchInput.addEventListener('input', handleSearch);
      historicalToggle.addEventListener('change', () => updateMapForYear(parseInt(slider.value, 10)));
      modernToggle.addEventListener('change', () => updateMapForYear(parseInt(slider.value, 10)));
      ancestralToggle.addEventListener('change', handleAncestralToggle);
      demographicsToggle.addEventListener('change', handleDemographicsToggle);
    }

    // ... rest of the interaction handlers and helper functions ...
    function handlePlayPause() {
      isPlaying = !isPlaying;
      playPauseBtn.innerHTML = isPlaying ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>` : `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
      if (isPlaying) {
        if (parseInt(slider.value) >= parseInt(slider.max)) slider.value = slider.min;
        animateTimeline();
      } else {
        cancelAnimationFrame(animationFrameId);
      }
    }

    function handleSearch(e) {
      const query = e.target.value.toLowerCase();
      if (query.length < 2) {
        searchResultsContainer.innerHTML = '';
        searchResultsContainer.classList.add('hidden');
        return;
      }
      const results = tribalLandsData.features.filter(f => f.properties.name.toLowerCase().includes(query)).slice(0, 5);
      searchResultsContainer.innerHTML = '';
      if (results.length > 0) {
        results.forEach(result => {
          const div = document.createElement('div');
          div.className = 'p-2 cursor-pointer hover:bg-indigo-500/50';
          div.textContent = result.properties.name;
          div.onclick = () => {
            zoomToFeature(result);
            searchInput.value = '';
            searchResultsContainer.classList.add('hidden');
          };
          searchResultsContainer.appendChild(div);
        });
        searchResultsContainer.classList.remove('hidden');
      } else {
        searchResultsContainer.classList.add('hidden');
      }
    }

    function handleAncestralToggle() {
      const isVisible = ancestralToggle.checked;
      map.setLayoutProperty('ancestral-fill', 'visibility', isVisible ? 'visible' : 'none');
      map.setLayoutProperty('ancestral-outline', 'visibility', isVisible ? 'visible' : 'none');
      if (isVisible) fetchAncestralLands();
    }

    function handleDemographicsToggle() {
      const isVisible = demographicsToggle.checked;
      map.setLayoutProperty('county-fill', 'visibility', isVisible ? 'visible' : 'none');
      map.setLayoutProperty('county-outline', 'visibility', isVisible ? 'visible' : 'none');
    }

    let abortController = new AbortController();
    async function fetchAncestralLands() {
      // ... (fetch logic remains the same)
    }

    function updateMapForYear(year) {
      // ... (update logic remains the same)
    }

    function animateTimeline() {
      // ... (animation logic remains the same)
    }

    function zoomToFeature(feature) {
      // ... (zoom logic remains the same)
    }

    function createCountyPopupHTML(props) {
      return `
                <div>
                    <h3>${props.NAME} County, ${props.STATE_NAME}</h3>
                    <canvas id="countyChart" width="280" height="150"></canvas>
                    <div class="mt-4 text-sm space-y-1">
                        <p><strong>AI/AN Population:</strong> ${((props.AI_AN_POP / props.TOTAL_POP) * 100).toFixed(1)}%</p>
                        <p><strong>Poverty Rate:</strong> ${props.POVERTY_RATE}%</p>
                        <p><strong>Median Income:</strong> $${props.MED_INCOME.toLocaleString()}</p>
                    </div>
                </div>
            `;
    }

    function createTribePopupHTML(props) {
      let videoHTML = '';
      if (props.videoUrl) {
        videoHTML = `
                    <div class="aspect-w-16 aspect-h-9 mt-4">
                        <iframe src="${props.videoUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                `;
      }
      return `
                <div>
                    <h3>${props.name}</h3>
                    <p>${props.description}</p>
                    <p class="text-xs text-gray-400 mt-2">Active: ${props.startYear}-${props.endYear}</p>
                    ${videoHTML}
                </div>
            `;
    }

    function renderCountyChart(props) {
      // Use a short timeout to ensure the canvas element is in the DOM
      setTimeout(() => {
        const ctx = document.getElementById('countyChart');
        if (!ctx) return;
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['AI/AN Population', 'Total Population'],
            datasets: [{
              label: 'Population',
              data: [props.AI_AN_POP, props.TOTAL_POP],
              backgroundColor: ['#f59e0b', '#4a5568'],
              borderColor: ['#fde047', '#a0aec0'],
              borderWidth: 1
            }]
          },
          options: {
            indexAxis: 'y',
            scales: { y: { beginAtZero: true } },
            plugins: { legend: { display: false } }
          }
        });
      }, 100);
    }

  });
</script>
</body>
</html>
